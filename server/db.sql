CREATE DATABASE supermercado;
USE supermercado;
CREATE TABLE users(id INT PRIMARY KEY AUTO_INCREMENT,user_name VARCHAR(100) NOT NULL UNIQUE,password_name VARCHAR(15) NOT NULL);
CREATE TABLE person(id INT PRIMARY KEY AUTO_INCREMENT,name VARCHAR(100) NOT NULL,birthday DATE NOT NULL,cash DECIMAL(12,2) NOT NULL DEFAULT 0,type INT NOT NULL DEFAULT 0, users_id INT NOT NULL REFERENCES users(id));
ALTER TABLE person ADD FOREIGN KEY(users_id) REFERENCES users(id);
CREATE TABLE product(id INT PRIMARY KEY AUTO_INCREMENT NOT NULL,name VARCHAR(100) NOT NULL, code VARCHAR(15) NOT NULL UNIQUE);
CREATE TABLE mark(id INT PRIMARY KEY AUTO_INCREMENT NOT NULL, name VARCHAR(100) NOT NULL);
CREATE TABLE product_item(id INT PRIMARY KEY AUTO_INCREMENT NOT NULL,due_date DATE NOT NULL,cant INT NOT NULL DEFAULT 0,price_unit DECIMAL(12,2) NOT NULL,mark_id INT NOT NULL,product_id INT NOT NULL);
ALTER TABLE product_item ADD FOREIGN KEY(mark_id) REFERENCES mark(id);
ALTER TABLE product_item ADD FOREIGN KEY(product_id) REFERENCES product(id);
CREATE TABLE fact(id INT PRIMARY KEY AUTO_INCREMENT NOT NULL,sale_date DATE NOT NULL DEFAULT CURRENT_DATE,price_to_pay DECIMAL(12,2) NOT NULL);
CREATE TABLE sales(id INT PRIMARY KEY AUTO_INCREMENT NOT NULL,product_item_id INT NOT NULL, fact_id INT NOT NULL,price_to_pay DECIMAL(12,2) NOT NULL, person_id INT NOT NULL);
ALTER TABLE sales ADD FOREIGN KEY(fact_id) REFERENCES fact(id);
ALTER TABLE sales ADD FOREIGN KEY(product_item_id) REFERENCES product_item(id);
ALTER TABLE sales ADD FOREIGN KEY(person_id) REFERENCES person(id);
CREATE TABLE history(id INT PRIMARY KEY NOT NULL AUTO_INCREMENT,fact_id INT NOT NULL,person_id INT NOT NULL);
ALTER TABLE history ADD FOREIGN KEY(fact_id) REFERENCES fact(id);
ALTER TABLE history ADD FOREIGN KEY(person_id) REFERENCES person(id);